{% extends 'base.html' %}
{% load static %}

{%block 'titulo' %} VER_LIVRO {% endblock %}

{% load my_filters %}

{% block 'head' %}
<link rel="stylesheet" href="{% static 'css/avaliacao.css' %}">

{% endblock %}
{%block 'conteudo' %}

<!-- Modal Excluir Livro -->
<div class="modal fade" id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Excluir - {{livro.nome}}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Deseja mesmo excluir este livro?
            </div>
            <div class="modal-footer">
                <a href="{% url 'excluir_livro' livro.id %}" class="btn btn-danger">Sim</a>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>

            </div>
        </div>
    </div>
</div>

<!-- Modal Avaliar Livro -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Avalie o empréstimo</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form action="{% url 'processa_avaliacao' %}" method="POST">
                    {% csrf_token %}
                    <input type="hidden" value="{{livro.id}}" name="id_livro">
                    <input type="hidden" id="id_emprestimo" name="id_emprestimo">
                    <select class="form-control" name="opcoes">
                        <option value="P">Péssimo</option>
                        <option value="R">Ruim</option>
                        <option value="B">Bom</option>
                        <option value="Ó">Ótimo</option>
                    </select>
                    <br>
                    <input type="submit" class="btn btn-info" value="Avaliar">
                </form>

            </div>

        </div>
    </div>
</div>




<div class="container">
    <br>
    <form action="{% url 'alterar_livro' livro.id %}" method="POST">
        {% csrf_token %}
        <input type="hidden" name="livro_id" value="{{livro.id}}">
        <p>
            <label for="">Título</label>
            <input class=" form-control" type="text" name="nome_livro" id="" value="{{livro.nome}}">
        </p>
        <p>
            <label for="">Autor</label>
            <input style="width: 50%;" class=" form-control" type="text" name="autor" id="" value="{{livro.autor}}">
        </p>
        <p>
            <label for="">Co-Autor</label>
            <input style="width: 50%;" class=" form-control" type="text" name="co_autor" id=""
                value="{{livro.co_autor}}">
        </p>
        <p>
            <label for="">Categoria: </label>
            <select name="categoria" id="">
                {% for categoria in categorias %}
                {% if livro.categoria == categoria %}
                <option value="{{categoria.id}}" selected>{{categoria.nome}}</option>
                {% else %}
                <option value="{{categoria.id}}">{{categoria.nome}}</option>
                {% endif %}
                {% endfor %}
            </select>

        </p>
        <p>
            <label for="">Data Cadastro:</label>
            {{livro.data_cadastro}}
        </p>


        <label for="">Disponível para empréstimo: </label>
        {% if not livro.emprestado %}
        <svg style="color: green;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
            class="bi bi-check-lg" viewBox="0 0 16 16">
            <path
                d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z" />
        </svg>
        {% else %}
        <svg style="color: red;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
            class="bi bi-x-lg" viewBox="0 0 16 16">
            <path
                d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z" />
        </svg>
        {% endif %}
        <br>
        <input type="submit" class="btn btn-success btn-lg" value="Salvar">

        <!-- Button trigger modal -->
        <button type="button" class="btn btn-danger btn-lg" data-toggle="modal" data-target="#exampleModal2">
            Excluir
        </button>
        <br>
        <br>

    </form>


    <hr>
    <h2>Histórico do emprestimo</h2>
    <table class="table table-striped table-dark">
        <thead>
            <tr>
                <th scope="col">Nome</th>
                <th scope="col">Data Emprestimo</th>
                <th scope="col">Data Devolução</th>
                <th scope="col">Tempo de Duração</th>
                <th scope="col">Avaliação</th>
            </tr>
        </thead>
        <tbody>
            {% for emprestimo in emprestimos %}
            <tr>
                {% if emprestimo.nome_emprestado %}
                <th scope="row">{{emprestimo.nome_emprestado}}</th>
                {% else %}
                <th scope="row">{{emprestimo.nome_emprestado_anonimo}}</th>
                {% endif %}

                <td>{{emprestimo.data_emprestimo}}</td>
                {% if emprestimo.data_devolucao %}
                <td>{{emprestimo.data_devolucao}}</td>
                {% else %}
                <td>Não devolvido</td>
                {% endif %}

                <td>{{emprestimo.data_devolucao | subtrai:emprestimo.data_emprestimo}} Dias</td>
                {% if emprestimo.data_devolucao %}
                {% if not emprestimo.avaliacao %}
                <td scope="row">
                    <button onclick="avaliacao('{{emprestimo.id}}')" type="button" class="btn btn-info"
                        data-toggle="modal" data-target="#exampleModal" data-emprestimo="{{emprestimo.id}}">
                        Avaliar
                    </button>
                </td>
                {% else %}
                <td scope="row">
                    <!-- Criar estrelas com JS -->

                    {% if emprestimo.avaliacao == "B" %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-star-fill" viewBox="0 0 16 16">
                        <path
                            d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-star-fill" viewBox="0 0 16 16">
                        <path
                            d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-star-fill" viewBox="0 0 16 16">
                        <path
                            d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                    </svg>
                    {% elif emprestimo.avaliacao == "R" %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-star-fill" viewBox="0 0 16 16">
                        <path
                            d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-star-fill" viewBox="0 0 16 16">
                        <path
                            d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                    </svg>
                    {% elif emprestimo.avaliacao == "Ó" %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-star-fill" viewBox="0 0 16 16">
                        <path
                            d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-star-fill" viewBox="0 0 16 16">
                        <path
                            d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-star-fill" viewBox="0 0 16 16">
                        <path
                            d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-star-fill" viewBox="0 0 16 16">
                        <path
                            d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                    </svg>
                    {% elif emprestimo.avaliacao == "P" %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-star-fill" viewBox="0 0 16 16">
                        <path
                            d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                    </svg>
                    {% endif %}

                </td>
                {% endif %}
                {% else %}
                <td><button class="btn btn-info disabled">Avaliar</button></td>
                {% endif %}
            </tr>
            {% endfor %}

        </tbody>
    </table>
</div>


<script src="{% static 'js/avaliacao.js' %}"></script>


{% endblock %}